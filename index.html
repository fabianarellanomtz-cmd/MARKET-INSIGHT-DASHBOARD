<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Intelligence Dashboard</title>

    <!-- Fonts: Inter for clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css?v=transparency_v54">
    <link rel="stylesheet" href="critical_synapse_fix.css?v=optimized_v1">
    <link rel="stylesheet" href="news_reader.css"> <!-- New Reader Styles -->
    <!-- Chart.js and Plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <!-- SheetJS for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Vis-Network for Synapse View -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <!-- CRITICAL: Synapse Full Height Override -->
    <style>
        /* Force Synapse view to use full viewport */
        #synapse-view:not(.hidden) {
            position: fixed !important;
            top: 0 !important;
            left: 280px !important;
            width: calc(100vw - 280px) !important;
            height: 100vh !important;
            z-index: 999 !important;
            background: rgba(15, 23, 42, 0.95) !important;
        }

        #synapse-graph-container {
            width: 100% !important;
            height: 100% !important;
        }

        /* Synapse Sidebar */
        #synapse-sidebar {
            position: absolute !important;
            top: 0 !important;
            right: 0 !important;
            width: 450px !important;
            height: 100% !important;
            background: rgba(15, 23, 42, 0.85) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border-left: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3) !important;
            transform: translateX(0) !important;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1) !important;
            z-index: 1000 !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
        }

        #synapse-sidebar.hidden {
            transform: translateX(100%) !important;
            pointer-events: none !important;
        }

        #synapse-details {
            padding: 2rem !important;
            overflow-y: auto !important;
            height: 100% !important;
            scrollbar-width: thin !important;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
        }

        .close-synapse-sidebar {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            color: #fff !important;
            font-size: 1rem !important;
            cursor: pointer !important;
            z-index: 10 !important;
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s !important;
        }

        .close-synapse-sidebar:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            transform: rotate(90deg) !important;
        }

        @media (max-width: 768px) {
            #synapse-view:not(.hidden) {
                left: 0 !important;
                width: 100vw !important;
            }

            #synapse-sidebar {
                width: 100% !important;
            }
        }
    </style>
    <!-- Added for Export -->
</head>

<body class="light-mode">
    <div class="app-container">
        <!-- Mobile Overlay -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="logo-icon"><i class="fa-solid fa-magnifying-glass-chart"></i></div>
                <h1>Market<span> Insights</span></h1>
                <button class="close-sidebar-btn" onclick="toggleSidebar()"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <!-- Main Navigation -->
            <nav class="main-nav">
                <button class="nav-item active" onclick="switchView('news')">
                    <i class="fa-regular fa-newspaper"></i> Noticias
                </button>
                <button class="nav-item" onclick="switchView('timeline')">
                    <i class="fa-solid fa-clock-rotate-left"></i> Cronolog칤a
                </button>
                <button class="nav-item" onclick="switchView('strategy')">
                    <i class="fa-solid fa-chart-pie"></i> Resumen Estrat칠gico
                </button>
                <button class="nav-item" onclick="switchView('synapse')">
                    <i class="fa-solid fa-circle-nodes"></i> Synapse
                </button>
            </nav>

            <!-- Upload Section Removed as per request -->

            <nav class="filters">
                <h3>Filtros</h3>

                <!-- NEW: Sidebar Search Input -->
                <div class="filter-group">
                    <label>游댌 Buscar</label>
                    <input type="text" id="sidebar-search-input" placeholder="Palabras clave..." class="form-control"
                        style="padding: 0.75rem; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.1); color: #ffffff; width: 100%;">
                </div>

                <div class="filter-group">
                    <label>Categor칤a</label>
                    <select id="macro-filter" class="form-control">
                        <option value="all">Todas</option>
                        <option value="negocio">Din치mica de Negocio</option>
                        <option value="retail">Retail & Distribuci칩n</option>
                        <option value="producto">Ciencia & Producto</option>
                        <option value="wellness">Wellness & Salud</option>
                        <option value="consumidor">Cultura & Consumidor</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Tema</label>
                    <select id="topic-filter">
                        <option value="all">Todos</option>
                        <!-- Dynamic options -->
                    </select>
                </div>

                <div class="filter-group">
                    <label>Subtema</label>
                    <select id="subtopic-filter">
                        <option value="all">Todos</option>
                    </select>
                </div>


                <!-- Product Pillar Filter -->
                <div class="filter-group">
                    <label>Pilar de Producto</label>
                    <select id="product-pillar-filter">
                        <option value="all">Todos los Pilares</option>
                        <option value="capilar">Capilar</option>
                        <option value="derma">Derma / Skincare</option>
                        <option value="inyectables">Inyectables</option>
                        <option value="equipos_medicos">Equipos M칠dicos</option>
                        <option value="quirurgico">Quir칰rgico</option>
                        <option value="ginecologico">Ginecol칩gico</option>
                        <option value="suplementos">Suplementos</option>
                        <option value="transversal">Transversal / Negocio</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Regi칩n</label>
                    <select id="region-filter">
                        <option value="all">Todas las Regiones</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Pa칤s</label>
                    <select id="country-filter">
                        <option value="all">Todos los Pa칤ses</option>
                    </select>
                </div>

                <!-- Sentiment buttons removed as requested -->

                <div class="filter-group">
                    <label>Fecha</label>
                    <div class="date-filters">
                        <select id="year-filter">
                            <option value="all">A침o</option>
                        </select>
                        <select id="month-filter">
                            <option value="all">Mes</option>
                        </select>
                    </div>
                </div>

                <div class="filter-group">
                    <label>Ordenar por</label>
                    <select id="sort-filter">
                        <option value="desc">M치s Reciente (Inicio)</option>
                        <option value="asc">M치s Antiguo (Inicio)</option>
                    </select>
                </div>

                <button class="reset-btn" id="reset-filters">Limpiar Filtros</button>

                <div style="margin-top: 2rem; border-top: 1px solid #e5e5e5; padding-top: 1rem;">
                    <button id="debug-btn"
                        style="background:transparent; border:1px solid #94a3b8; color:#64748b; font-size:0.7rem; padding:4px 8px; width:100%; border-radius:4px; cursor:pointer;">
                        <i class="fa-solid fa-bug"></i> Diagn칩stico de Datos
                    </button>
                </div>
            </nav>

            <div class="suggestion-box">
                <h4><i class="fa-regular fa-lightbulb"></i> Sugerir Noticia</h4>
                <form id="suggestion-form" action="https://formsubmit.co/fabian.arellano.mtz@gmail.com" method="POST">
                    <input type="text" name="link" placeholder="Pega el enlace aqu칤..." required>
                    <input type="hidden" name="_subject" value="Nueva Sugerencia de Noticia - Market Insights">
                    <input type="hidden" name="_captcha" value="false">
                    <button type="submit">Enviar <i class="fa-solid fa-paper-plane"></i></button>
                </form>
                <p id="suggestion-status" class="hidden"></p>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="mobile-header-controls">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>

                <div class="search-bar" id="search-container">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="search-input" placeholder="Buscar noticias, palabras clave...">
                </div>

                <!-- Theme Switcher -->
                <div class="theme-switcher-container" style="margin-left: 1rem; margin-right: 1rem;">
                    <select id="theme-select"
                        style="padding: 0.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: #1e293b; font-size: 0.85rem; font-weight: 500; cursor: pointer; backdrop-filter: blur(4px);">
                        <option value="bg-beige">游꿛 Clean Nature (Beige)</option>
                        <option value="bg-agua">游깱 Deep Water (Original)</option>
                        <option value="bg-verde">游 Fresh Mint (Verde)</option>
                        <option value="bg-azul">游댯 Deep Ocean (Azul)</option>
                        <option value="bg-botanical">游꺔 Botanical Science</option>
                        <option value="bg-lab">游댧 Modern Lab Aesthetic</option>
                    </select>
                </div>

                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-val" id="total-count">0</span>
                        <span class="stat-label">Noticias</span>
                    </div>
                </div>
            </header>

            <div class="content-area">
                <div id="loading-state" class="center-msg hidden">
                    <div class="spinner"></div>
                    <p>Procesando archivo...</p>
                </div>

                <div id="empty-state" class="center-msg">
                    <div class="empty-icon"><i class="fa-regular fa-folder-open"></i></div>
                    <h2>No hay datos cargados</h2>
                    <p>Sube tu archivo Excel o CSV para comenzar el an치lisis.</p>
                    <button class="primary-btn" onclick="document.getElementById('file-input').click()">Subir
                        Archivo</button>
                </div>

                <div id="news-grid" class="news-grid hidden">
                    <!-- Cards will be injected here -->
                </div>

                <!-- View: Strategic Summary -->
                <div id="strategic-view" class="strategic-view hidden">
                    <!-- Summary content injected here -->
                </div>

                <!-- View: Timeline (New) -->
                <div id="timeline-view" class="timeline-view hidden">
                    <!-- Timeline content injected here -->
                </div>

                <!-- View: Synapse (Network Graph) -->
                <div id="synapse-view" class="synapse-view hidden">
                    <div id="synapse-graph-container"></div>
                    <div id="synapse-sidebar" class="hidden">
                        <button class="close-synapse-sidebar" onclick="closeSynapseSidebar()"><i
                                class="fa-solid fa-xmark"></i></button>
                        <div id="synapse-details">
                            <!-- Details injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Dynamic Infographic Modal -->
    <div id="article-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modal-content-inject">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Immersive News Reader Overlay -->
    <div id="news-reader-overlay" class="hidden">
        <div class="reader-backdrop" onclick="closeNewsReader()"></div>
        <div class="reader-container">
            <div class="reader-content">
                <header class="reader-header">
                    <button class="reader-close-btn" onclick="closeNewsReader()"><i
                            class="fa-solid fa-xmark"></i></button>
                    <div class="reader-meta-tags" id="reader-tags">
                        <!-- Tags injected here -->
                    </div>
                    <div
                        style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem;">
                        <h2 class="reader-title" id="reader-title" style="margin-bottom:0;">T칤tulo de la Noticia</h2>
                    </div>
                    <div class="reader-date" id="reader-date">
                        <i class="fa-regular fa-calendar"></i> <span>Fecha</span>
                    </div>
                </header>
                <div class="reader-body">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                        <span class="ai-badge"><i class="fa-solid fa-wand-magic-sparkles"></i> An치lisis IA</span>
                    </div>
                    <div class="reader-summary" id="reader-summary">
                        <!-- Summary injected here -->
                    </div>

                    <div id="reader-related-content" style="margin-top:2rem;">
                        <!-- Related news injected here -->
                    </div>


                </div>
                <footer class="reader-footer">
                    <button class="reader-btn secondary" onclick="closeNewsReader()">Cerrar</button>
                    <a href="#" target="_blank" id="reader-link" class="reader-btn primary">
                        Leer Fuente Original <i class="fa-solid fa-arrow-up-right-from-square"></i>
                    </a>
                </footer>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js?v=transparency_v58"></script>
</body>

</html>